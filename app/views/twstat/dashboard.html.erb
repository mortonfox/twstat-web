<h1>Twitter Archive Stats - Dashboard</h1>

<p>Logged in as <%=h session[:username] %> (<%=h session[:userid] %>)</p>

<% case @user_status['status'] %>
<% when 'busy' %>

  <p>
  <% if @cancel %>
    Canceling...
  <% else %>
    Processing Twitter archive... <br />
    <%= @user_status['tweetsDone'] %> tweets back to 
    <%= @user_status['untilDate'] %>
    <%= render :partial => 'cancelbutton' %>
  <% end %>

<% when 'waiting' %>
  <p>
  <% if @cancel %>
    Canceling...
  <% else %>
    Queued...
    <%= render :partial => 'cancelbutton' %>
  <% end %>

<% else %>  

  <% if @user_status['status'] == 'error' %>
    <p class='error'><%= @user_status['errorMsg'] %></p>
  <% end %>

  <p>
  <% if @last_generated %>
    <%= link_to 'View report', :action => :report, :userid => @userid %><br />
    (Last report run: <%= @last_generated.strftime '%Y-%m-%d %H:%M' %>)
  <% else %>
    No saved report.
  <% end %>

  <%= form_tag({ :action => :upload }, :multipart => true) do %>
    tweets.zip file: <%= file_field_tag :tweetdata %>
    <%= submit_tag('Upload') %>
  <% end %>

<% end %>

<p><%= link_to 'Logout', :action => :logout %> | <%= link_to 'Help/About', :action => :about %></p>

